@page "/ExternalLoginCallback/{Email}/{Password}"
@using Sample.BlazorServerAPP.DTO;
@using Sample.BlazorServerAPP.Service;
@inject NavigationManager _nav
@inject IAuthRepository _authRepo



<MudCard BackgroundColor="Color.Info" TextColor="Color.PrimaryText">
    <MudCardHeader BackgroundColor="Color.Dark" TextColor="Color.WarningText">
       
    </MudCardHeader>
    <MudCardContent>
       In Process......................
    </MudCardContent>
</MudCard>


@code {
    [Parameter]
    public string Email { get; set; }
    [Parameter]
    public string Password { get; set; }
    LoginDTO userDto = new LoginDTO();
    protected override async Task OnInitializedAsync()
    {

        CallJavaScriptInterop();
    }
    private bool hasBeenCalled = false;

    private async Task CallJavaScriptInterop()
    {
        if (!hasBeenCalled)
        {
            // Avoid making multiple calls
            hasBeenCalled = true;
             userDto.Password = Password;
            userDto.Email = Email;
            var responce = await _authRepo.Login(userDto);
            if (responce)
            {
                _nav.NavigateTo("/personal/dashboard");
            }
            else
            {
                _nav.NavigateTo("/login");
            }
        }
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            // Make JavaScript interop calls here.
            await CallJavaScriptInterop();
        }
    }
}
